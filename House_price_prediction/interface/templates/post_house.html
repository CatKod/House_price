{% extends "base.html" %}

{% block title %}ƒêƒÉng tin b·∫•t ƒë·ªông s·∫£n{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10 col-xl-8">
        <div class="card shadow-lg">
            <div class="card-header text-center py-4">
                <h2 class="mb-2">
                    <i class="fas fa-plus-circle me-2"></i>
                    {% if session.get('is_admin') %}
                        <span class="gradient-text">ƒêƒÉng tin b·∫•t ƒë·ªông s·∫£n</span>
                        <small class="badge bg-success ms-2">Admin</small>
                    {% else %}
                        <span class="gradient-text">ƒêƒÉng tin b·∫•t ƒë·ªông s·∫£n</span>
                        <small class="badge bg-warning ms-2">Ch·ªù ph√™ duy·ªát</small>
                    {% endif %}
                </h2>
                {% if not session.get('is_admin') %}
                <p class="text-white-50 mb-0">
                    <i class="fas fa-info-circle me-1"></i>
                    B√†i ƒëƒÉng s·∫Ω ƒë∆∞·ª£c admin ph√™ duy·ªát tr∆∞·ªõc khi hi·ªÉn th·ªã
                </p>
                {% endif %}
            </div>
            
            <div class="card-body p-4">
                {% if not session.get('is_admin') %}
                <div class="alert alert-info border-0 mb-4">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-clock text-info fs-4 me-3"></i>
                        <div>
                            <h6 class="alert-heading mb-1">Quy tr√¨nh ph√™ duy·ªát</h6>
                            <small>B√†i ƒëƒÉng c·ªßa b·∫°n s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒë·∫øn admin ƒë·ªÉ ki·ªÉm tra v√† ph√™ duy·ªát tr∆∞·ªõc khi xu·∫•t hi·ªán tr√™n website.</small>
                        </div>
                    </div>
                </div>
                {% endif %}

                <form method="POST" class="needs-validation" novalidate>
                    <!-- Th√¥ng tin c∆° b·∫£n -->
                    <div class="form-section mb-5">
                        <div class="section-header mb-4">
                            <h4 class="section-title">
                                <i class="fas fa-info-circle text-primary me-2"></i>
                                Th√¥ng tin c∆° b·∫£n
                            </h4>
                            <div class="section-line"></div>
                        </div>
                        
                        <div class="row g-4">
                            <div class="col-12">
                                <div class="form-floating">
                                    <input type="text" class="form-control form-control-lg" id="title" name="title" 
                                           placeholder="Nh·∫≠p ti√™u ƒë·ªÅ b·∫•t ƒë·ªông s·∫£n" required>
                                    <label for="title">
                                        <i class="fas fa-heading me-1"></i>
                                        Ti√™u ƒë·ªÅ <span class="text-danger">*</span>
                                    </label>
                                    <div class="invalid-feedback">Vui l√≤ng nh·∫≠p ti√™u ƒë·ªÅ</div>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="form-floating">
                                    <textarea class="form-control" id="address" name="address" 
                                              placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ chi ti·∫øt" style="height: 100px" required></textarea>
                                    <label for="address">
                                        <i class="fas fa-map-marker-alt me-1"></i>
                                        ƒê·ªãa ch·ªâ <span class="text-danger">*</span>
                                    </label>
                                    <div class="invalid-feedback">Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ</div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-floating">
                                    <select class="form-select form-select-lg" id="district" name="district" required>
                                        <option value="">Ch·ªçn qu·∫≠n/huy·ªán</option>
                                        <option value="Ba ƒê√¨nh" {% if selected_district == 'Ba ƒê√¨nh' %}selected{% endif %}>Ba ƒê√¨nh</option>
                                        <option value="C·∫ßu Gi·∫•y" {% if selected_district == 'C·∫ßu Gi·∫•y' %}selected{% endif %}>C·∫ßu Gi·∫•y</option>
                                        <option value="Ho√†n Ki·∫øm" {% if selected_district == 'Ho√†n Ki·∫øm' %}selected{% endif %}>Ho√†n Ki·∫øm</option>
                                        <option value="Hai B√† Tr∆∞ng" {% if selected_district == 'Hai B√† Tr∆∞ng' %}selected{% endif %}>Hai B√† Tr∆∞ng</option>
                                        <option value="Ho√†ng Mai" {% if selected_district == 'Ho√†ng Mai' %}selected{% endif %}>Ho√†ng Mai</option>
                                        <option value="ƒê·ªëng ƒêa" {% if selected_district == 'ƒê·ªëng ƒêa' %}selected{% endif %}>ƒê·ªëng ƒêa</option>
                                        <option value="H√† ƒê√¥ng" {% if selected_district == 'H√† ƒê√¥ng' %}selected{% endif %}>H√† ƒê√¥ng</option>
                                        <option value="T√¢y H·ªì" {% if selected_district == 'T√¢y H·ªì' %}selected{% endif %}>T√¢y H·ªì</option>
                                        <option value="Long Bi√™n" {% if selected_district == 'Long Bi√™n' %}selected{% endif %}>Long Bi√™n</option>
                                        <option value="Nam T·ª´ Li√™m" {% if selected_district == 'Nam T·ª´ Li√™m' %}selected{% endif %}>Nam T·ª´ Li√™m</option>
                                        <option value="Thanh Xu√¢n" {% if selected_district == 'Thanh Xu√¢n' %}selected{% endif %}>Thanh Xu√¢n</option>
                                        <option value="ƒê√¥ng Anh" {% if selected_district == 'ƒê√¥ng Anh' %}selected{% endif %}>ƒê√¥ng Anh</option>
                                        <option value="S√≥c S∆°n" {% if selected_district == 'S√≥c S∆°n' %}selected{% endif %}>S√≥c S∆°n</option>
                                        <option value="Gia L√¢m" {% if selected_district == 'Gia L√¢m' %}selected{% endif %}>Gia L√¢m</option>
                                        <option value="Thanh Tr√¨" {% if selected_district == 'Thanh Tr√¨' %}selected{% endif %}>Thanh Tr√¨</option>
                                        <option value="M√™ Linh" {% if selected_district == 'M√™ Linh' %}selected{% endif %}>M√™ Linh</option>
                                        <option value="S∆°n T√¢y" {% if selected_district == 'S∆°n T√¢y' %}selected{% endif %}>S∆°n T√¢y</option>
                                        <option value="B·∫Øc T·ª´ Li√™m" {% if selected_district == 'B·∫Øc T·ª´ Li√™m' %}selected{% endif %}>B·∫Øc T·ª´ Li√™m</option>
                                        <option value="Ch∆∞∆°ng M·ªπ" {% if selected_district == 'Ch∆∞∆°ng M·ªπ' %}selected{% endif %}>Ch∆∞∆°ng M·ªπ</option>
                                        <option value="Ba V√¨" {% if selected_district == 'Ba V√¨' %}selected{% endif %}>Ba V√¨</option>
                                        <option value="ƒêan Ph∆∞·ª£ng" {% if selected_district == 'ƒêan Ph∆∞·ª£ng' %}selected{% endif %}>ƒêan Ph∆∞·ª£ng</option>
                                        <option value="Ho√†i ƒê·ª©c" {% if selected_district == 'Ho√†i ƒê·ª©c' %}selected{% endif %}>Ho√†i ƒê·ª©c</option>
                                        <option value="Qu·ªëc Oai" {% if selected_district == 'Qu·ªëc Oai' %}selected{% endif %}>Qu·ªëc Oai</option>
                                        <option value="Th·∫°ch Th·∫•t" {% if selected_district == 'Th·∫°ch Th·∫•t' %}selected{% endif %}>Th·∫°ch Th·∫•t</option>
                                        <option value="Ph√∫c Th·ªç" {% if selected_district == 'Ph√∫c Th·ªç' %}selected{% endif %}>Ph√∫c Th·ªç</option>
                                        <option value="Thanh Oai" {% if selected_district == 'Thanh Oai' %}selected{% endif %}>Thanh Oai</option>
                                        <option value="·ª®ng H√≤a" {% if selected_district == '·ª®ng H√≤a' %}selected{% endif %}>·ª®ng H√≤a</option>
                                        <option value="Th∆∞·ªùng T√≠n" {% if selected_district == 'Th∆∞·ªùng T√≠n' %}selected{% endif %}>Th∆∞·ªùng T√≠n</option>
                                        <option value="Ph√∫ Xuy√™n" {% if selected_district == 'Ph√∫ Xuy√™n' %}selected{% endif %}>Ph√∫ Xuy√™n</option>
                                        <option value="M·ªπ ƒê·ª©c" {% if selected_district == 'M·ªπ ƒê·ª©c' %}selected{% endif %}>M·ªπ ƒê·ª©c</option>
                                    </select>
                                    <label for="district">
                                        <i class="fas fa-building me-1"></i>
                                        Qu·∫≠n/Huy·ªán <span class="text-danger">*</span>
                                    </label>
                                    <div class="invalid-feedback">Vui l√≤ng ch·ªçn qu·∫≠n/huy·ªán</div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-floating">
                                    <select class="form-select form-select-lg" id="post_type" name="post_type" required>
                                        <option value="">Ch·ªçn lo·∫°i tin</option>
                                        <option value="B√°n">üè† B√°n</option>
                                        <option value="Cho thu√™">üè° Cho thu√™</option>
                                    </select>
                                    <label for="post_type">
                                        <i class="fas fa-tags me-1"></i>
                                        Lo·∫°i tin ƒëƒÉng <span class="text-danger">*</span>
                                    </label>
                                    <div class="invalid-feedback">Vui l√≤ng ch·ªçn lo·∫°i tin</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Th√¥ng tin gi√° v√† di·ªán t√≠ch -->
                    <div class="form-section mb-5">
                        <div class="section-header mb-4">
                            <h4 class="section-title">
                                <i class="fas fa-money-bill-wave text-success me-2"></i>
                                Gi√° v√† di·ªán t√≠ch
                            </h4>
                            <div class="section-line"></div>
                        </div>

                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="text" class="form-control form-control-lg" id="price" name="price" 
                                           placeholder="VD: 5000000000 ho·∫∑c Th·ªèa thu·∫≠n" required>
                                    <label for="price">
                                        <i class="fas fa-dollar-sign me-1"></i>
                                        Gi√° <span class="text-danger">*</span>
                                    </label>
                                    <div class="form-text">üí° Nh·∫≠p gi√° b·∫±ng s·ªë (VNƒê) ho·∫∑c "Th·ªèa thu·∫≠n"</div>
                                    <div class="invalid-feedback">Vui l√≤ng nh·∫≠p gi√°</div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="number" class="form-control form-control-lg" id="area" name="area" 
                                           min="1" step="0.1" placeholder="VD: 100" required>
                                    <label for="area">
                                        <i class="fas fa-ruler-combined me-1"></i>
                                        Di·ªán t√≠ch (m¬≤) <span class="text-danger">*</span>
                                    </label>
                                    <div class="invalid-feedback">Vui l√≤ng nh·∫≠p di·ªán t√≠ch</div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-floating">
                                    <select class="form-select" id="direction" name="direction">
                                        <option value="">Ch·ªçn h∆∞·ªõng</option>
                                        <option value="ƒê√¥ng">üåÖ ƒê√¥ng</option>
                                        <option value="T√¢y">üåÜ T√¢y</option>
                                        <option value="Nam">‚òÄÔ∏è Nam</option>
                                        <option value="B·∫Øc">‚ùÑÔ∏è B·∫Øc</option>
                                        <option value="ƒê√¥ng Nam">üå§Ô∏è ƒê√¥ng Nam</option>
                                        <option value="ƒê√¥ng B·∫Øc">üå®Ô∏è ƒê√¥ng B·∫Øc</option>
                                        <option value="T√¢y Nam">üåá T√¢y Nam</option>
                                        <option value="T√¢y B·∫Øc">üå®Ô∏è T√¢y B·∫Øc</option>
                                    </select>
                                    <label for="direction">
                                        <i class="fas fa-compass me-1"></i>
                                        H∆∞·ªõng nh√†
                                    </label>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="number" class="form-control" id="width_meters" name="width_meters" 
                                           min="1" step="0.1" placeholder="VD: 5.5" required>
                                    <label for="width_meters">
                                        <i class="fas fa-arrows-alt-h me-1"></i>
                                        Chi·ªÅu r·ªông (m) <span class="text-danger">*</span>
                                    </label>
                                    <div class="invalid-feedback">Vui l√≤ng nh·∫≠p chi·ªÅu r·ªông</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Th√¥ng tin ph√≤ng -->
                    <div class="form-section mb-5">
                        <div class="section-header mb-4">
                            <h4 class="section-title">
                                <i class="fas fa-home text-warning me-2"></i>
                                Th√¥ng tin ph√≤ng
                            </h4>
                            <div class="section-line"></div>
                        </div>

                        <div class="row g-4">
                            <div class="col-md-4">
                                <div class="form-floating">
                                    <input type="number" class="form-control" id="bedrooms" name="bedrooms" 
                                           min="1" placeholder="VD: 3" required>
                                    <label for="bedrooms">
                                        <i class="fas fa-bed me-1"></i>
                                        Ph√≤ng ng·ªß <span class="text-danger">*</span>
                                    </label>
                                    <div class="invalid-feedback">Vui l√≤ng nh·∫≠p s·ªë ph√≤ng ng·ªß</div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-floating">
                                    <input type="number" class="form-control" id="bathrooms" name="bathrooms" 
                                           min="1" placeholder="VD: 2" required>
                                    <label for="bathrooms">
                                        <i class="fas fa-bath me-1"></i>
                                        Ph√≤ng t·∫Øm <span class="text-danger">*</span>
                                    </label>
                                    <div class="invalid-feedback">Vui l√≤ng nh·∫≠p s·ªë ph√≤ng t·∫Øm</div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-floating">
                                    <input type="number" class="form-control" id="floors" name="floors" 
                                           min="1" placeholder="VD: 3" required>
                                    <label for="floors">
                                        <i class="fas fa-layer-group me-1"></i>
                                        S·ªë t·∫ßng <span class="text-danger">*</span>
                                    </label>
                                    <div class="invalid-feedback">Vui l√≤ng nh·∫≠p s·ªë t·∫ßng</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Th√¥ng tin ph√°p l√Ω v√† n·ªôi th·∫•t -->
                    <div class="form-section mb-5">
                        <div class="section-header mb-4">
                            <h4 class="section-title">
                                <i class="fas fa-clipboard-list text-info me-2"></i>
                                Th√¥ng tin kh√°c
                            </h4>
                            <div class="section-line"></div>
                        </div>

                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <select class="form-select" id="legal" name="legal" required>
                                        <option value="">Ch·ªçn lo·∫°i gi·∫•y t·ªù</option>
                                        <option value="S·ªï ƒë·ªè">üìã S·ªï ƒë·ªè</option>
                                        <option value="S·ªï h·ªìng">üìÑ S·ªï h·ªìng</option>
                                        <option value="Gi·∫•y t·ªù h·ª£p l·ªá">‚úÖ Gi·∫•y t·ªù h·ª£p l·ªá</option>
                                        <option value="ƒêang ch·ªù s·ªï">‚è≥ ƒêang ch·ªù s·ªï</option>
                                        <option value="Kh√¥ng">‚ùå Kh√¥ng</option>
                                    </select>
                                    <label for="legal">
                                        <i class="fas fa-certificate me-1"></i>
                                        Gi·∫•y t·ªù ph√°p l√Ω <span class="text-danger">*</span>
                                    </label>
                                    <div class="invalid-feedback">Vui l√≤ng ch·ªçn gi·∫•y t·ªù ph√°p l√Ω</div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-floating">
                                    <select class="form-select" id="interior" name="interior" required>
                                        <option value="">T√¨nh tr·∫°ng n·ªôi th·∫•t</option>
                                        <option value="ƒê·∫ßy ƒë·ªß">üè† ƒê·∫ßy ƒë·ªß</option>
                                        <option value="C∆° b·∫£n">üè° C∆° b·∫£n</option>
                                        <option value="Cao c·∫•p">üè∞ Cao c·∫•p</option>
                                        <option value="Kh√¥ng n·ªôi th·∫•t">üèóÔ∏è Kh√¥ng n·ªôi th·∫•t</option>
                                    </select>
                                    <label for="interior">
                                        <i class="fas fa-couch me-1"></i>
                                        N·ªôi th·∫•t <span class="text-danger">*</span>
                                    </label>
                                    <div class="invalid-feedback">Vui l√≤ng ch·ªçn t√¨nh tr·∫°ng n·ªôi th·∫•t</div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="number" class="form-control" id="entrancewidth" name="entrancewidth" 
                                           min="0" step="0.1" placeholder="VD: 3.0">
                                    <label for="entrancewidth">
                                        <i class="fas fa-door-open me-1"></i>
                                        Chi·ªÅu r·ªông l·ªëi v√†o (m)
                                    </label>
                                    <div class="form-text">üí° ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng bi·∫øt</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action buttons -->
                    <div class="d-flex justify-content-between align-items-center pt-4 border-top">
                        <a href="{{ url_for('index') }}" class="btn btn-outline-secondary btn-lg">
                            <i class="fas fa-arrow-left me-2"></i>
                            Quay l·∫°i
                        </a>
                        <button type="submit" class="btn btn-primary btn-lg px-5">
                            <i class="fas fa-paper-plane me-2"></i>
                            {% if session.get('is_admin') %}
                                ƒêƒÉng tin ngay
                            {% else %}
                                G·ª≠i ƒë·ªÉ ph√™ duy·ªát
                            {% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
.gradient-text {
    background: linear-gradient(45deg, #667eea, #764ba2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.form-section {
    position: relative;
}

.section-header {
    position: relative;
    margin-bottom: 2rem;
}

.section-title {
    color: #2c3e50;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.section-line {
    height: 3px;
    background: linear-gradient(90deg, #667eea, #764ba2);
    border-radius: 2px;
    width: 60px;
}

.form-floating > .form-control,
.form-floating > .form-select {
    padding-top: 1.625rem;
    padding-bottom: 0.625rem;
    height: auto;
    min-height: calc(3.5rem + 2px);
}

.form-floating > label {
    padding: 1rem 1rem;
    color: #6c757d;
    font-weight: 500;
}

.form-control:focus,
.form-select:focus {
    box-shadow: 0 0 0 0.25rem rgba(102, 126, 234, 0.25);
    border-color: #667eea;
}

.btn-lg {
    padding: 12px 30px;
    font-size: 1.1rem;
    font-weight: 600;
}

.alert {
    border-left: 4px solid #3498db;
}

@media (max-width: 768px) {
    .form-floating > .form-control,
    .form-floating > .form-select {
        min-height: calc(3rem + 2px);
    }
    
    .btn-lg {
        width: 100%;
        margin: 5px 0;
    }
    
    .d-flex.justify-content-between {
        flex-direction: column;
    }
}
</style>

<script>
// Auto-format price input with thousand separators
document.getElementById('price').addEventListener('input', function(e) {
    let value = e.target.value;
    if (!isNaN(value) && value !== '' && value !== 'Th·ªèa thu·∫≠n' && value !== 'Tho·∫£ thu·∫≠n') {
        // Remove existing formatting
        let numericValue = value.replace(/,/g, '');
        if (!isNaN(numericValue)) {
            // Format with thousand separators
            let formatted = parseInt(numericValue).toLocaleString('vi-VN');
            e.target.value = formatted;
        }
    }
});

// Bootstrap form validation
(function() {
    'use strict';
    window.addEventListener('load', function() {
        var forms = document.getElementsByClassName('needs-validation');
        var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
                if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    }, false);
})();

// Advanced form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const price = document.getElementById('price').value;
    const area = parseFloat(document.getElementById('area').value);
    const widthMeters = parseFloat(document.getElementById('width_meters').value);
    
    // Validate price
    if (price !== 'Th·ªèa thu·∫≠n' && price !== 'Tho·∫£ thu·∫≠n') {
        let numericPrice = price.replace(/,/g, '');
        if (isNaN(numericPrice) || parseFloat(numericPrice) <= 0) {
            alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p gi√° h·ª£p l·ªá ho·∫∑c "Th·ªèa thu·∫≠n"');
            e.preventDefault();
            return;
        }
    }
    
    // Validate area
    if (area <= 0) {
        alert('‚ö†Ô∏è Di·ªán t√≠ch ph·∫£i l·ªõn h∆°n 0');
        e.preventDefault();
        return;
    }
    
    // Validate width
    if (widthMeters <= 0) {
        alert('‚ö†Ô∏è Chi·ªÅu r·ªông ph·∫£i l·ªõn h∆°n 0');
        e.preventDefault();
        return;
    }
    
    // Show loading state
    const submitBtn = e.target.querySelector('button[type="submit"]');
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>ƒêang x·ª≠ l√Ω...';
    submitBtn.disabled = true;
});
</script>
{% endblock %}
