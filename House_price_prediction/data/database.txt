-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public.admin
(
    admin_id text COLLATE pg_catalog."default" NOT NULL,
    admin_name text COLLATE pg_catalog."default" NOT NULL,
    password text COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT admin_pkey PRIMARY KEY (admin_id)
);

CREATE TABLE IF NOT EXISTS public.deposit
(
    user_id text COLLATE pg_catalog."default" NOT NULL,
    house_id text COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT deposit_pkey PRIMARY KEY (user_id, house_id)
);

CREATE TABLE IF NOT EXISTS public.favorite
(
    user_id text COLLATE pg_catalog."default" NOT NULL,
    house_id text COLLATE pg_catalog."default" NOT NULL
);

CREATE TABLE IF NOT EXISTS public.house_prices
(
    house_id text COLLATE pg_catalog."default" NOT NULL,
    "Title" text COLLATE pg_catalog."default",
    "Address" text COLLATE pg_catalog."default",
    "District" text COLLATE pg_catalog."default",
    "PostingDate" text COLLATE pg_catalog."default",
    "PostType" text COLLATE pg_catalog."default",
    "Price" text COLLATE pg_catalog."default",
    "Area" double precision,
    "Direction" text COLLATE pg_catalog."default",
    "Bedrooms" bigint,
    "Bathrooms" bigint,
    "Floors" bigint,
    "Width_meters" double precision,
    "Legal" text COLLATE pg_catalog."default",
    "Interior" text COLLATE pg_catalog."default",
    "Entrancewidth" double precision,
    CONSTRAINT house_prices_pkey PRIMARY KEY (house_id)
);

CREATE TABLE IF NOT EXISTS public.statues
(
    house_id text COLLATE pg_catalog."default" NOT NULL,
    statue text COLLATE pg_catalog."default" DEFAULT 'Đang bán'::text,
    poster_id text COLLATE pg_catalog."default" DEFAULT 'admin'::text,
    CONSTRAINT statues_pkey PRIMARY KEY (house_id)
);

CREATE TABLE IF NOT EXISTS public.users
(
    user_id text COLLATE pg_catalog."default" NOT NULL,
    username text COLLATE pg_catalog."default" NOT NULL,
    password text COLLATE pg_catalog."default" NOT NULL,
    phone bigint,
    CONSTRAINT users_pkey PRIMARY KEY (user_id)
);

CREATE TABLE IF NOT EXISTS public.wait_for_admin
(
    house_id text COLLATE pg_catalog."default" NOT NULL,
    "Title" text COLLATE pg_catalog."default",
    "Address" text COLLATE pg_catalog."default",
    "District" text COLLATE pg_catalog."default",
    "PostingDate" text COLLATE pg_catalog."default",
    "PostType" text COLLATE pg_catalog."default",
    "Price" text COLLATE pg_catalog."default",
    "Area" double precision,
    "Direction" text COLLATE pg_catalog."default",
    "Bedrooms" bigint,
    "Bathrooms" bigint,
    "Floors" bigint,
    "Width_meters" double precision,
    "Legal" text COLLATE pg_catalog."default",
    "Interior" text COLLATE pg_catalog."default",
    "Entrancewidth" double precision,
    statue text COLLATE pg_catalog."default" DEFAULT 'Đang chờ duyệt'::text,
    poster_id text COLLATE pg_catalog."default" DEFAULT 'admin'::text,
    CONSTRAINT wait_for_admin_pkey PRIMARY KEY (house_id)
);

ALTER TABLE IF EXISTS public.deposit
    ADD CONSTRAINT deposit_house_id_fkey FOREIGN KEY (house_id)
    REFERENCES public.house_prices (house_id) MATCH SIMPLE
    ON UPDATE CASCADE
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS idx_deposit_house_id
    ON public.deposit(house_id);


ALTER TABLE IF EXISTS public.deposit
    ADD CONSTRAINT deposit_user_id_fkey FOREIGN KEY (user_id)
    REFERENCES public.users (user_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.favorite
    ADD CONSTRAINT favorite_house_id_fkey FOREIGN KEY (house_id)
    REFERENCES public.house_prices (house_id) MATCH SIMPLE
    ON UPDATE CASCADE
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS idx_favorite_house_id
    ON public.favorite(house_id);


ALTER TABLE IF EXISTS public.favorite
    ADD CONSTRAINT favorite_user_id_fkey FOREIGN KEY (user_id)
    REFERENCES public.users (user_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.statues
    ADD CONSTRAINT statues_house_id_fkey FOREIGN KEY (house_id)
    REFERENCES public.house_prices (house_id) MATCH SIMPLE
    ON UPDATE CASCADE
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS statues_pkey
    ON public.statues(house_id);

END;

CREATE OR REPLACE VIEW public.property
 AS
 SELECT house_id,
    "Title" AS title,
    "District" AS district,
    "Price" AS price,
    "Area"::numeric AS area,
    "Bedrooms"::integer AS bedrooms,
    "Bathrooms"::integer AS bathrooms
   FROM house_prices;

ALTER TABLE public.property
    OWNER TO postgres;